<!--/workspaces/Inventory-Management-System/app/views/orders/_form.html.erb-->
<!--/workspaces/Inventory-Management-System/app/views/orders/_form.html.erb-->
<%= form_with(model: order) do |form| %>
  <% if order.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(order.errors.count, "error") %> prohibited this order from being saved:</h2>

      <ul>
        <% order.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= form.label :expected_delivery, style: "display: block" %>
    <%= form.date_field :expected_delivery %>
  </div>

  <div>
    <%= form.label :status, style: "display: block" %>
    <%= form.select :status, ['Processing', 'In Transit', 'Delivered'] %>
  </div>

  <div>
    <%= form.label :sending_address, style: "display: block" %>
    <% if order.new_record? %>
      <%= form.collection_select :sending_address, StorageLocation.all, :address, :address %>
    <% else %>
      <%= form.text_field :sending_address %>
    <% end %>
  </div>

  <div>
    <%= form.label :receiving_address, style: "display: block" %>
    <%= form.text_field :receiving_address %>
  </div>

  <div>
    <%= form.label :description, style: "display: block" %>
    <%= form.text_field :description %>
  </div>
  <p>
    <script>
      $(document).ready(function() {
        var table = $('#dataTable').DataTable({
          paging: true,
          ordering: true,
          selectable: true,
          fixedheader: true
        });
      });
    </script>
    <div class="row">
      <div id="incoming" class="col">
        <div class="card shadow mb-4">
          <div class="card-header py-3 collapse-header" data-toggle="collapse" data-target="#incomingTableCollapse">
            <h6 class="m-0 font-weight-regular text-black">Full Inventory</h6>
          </div>
          <div class="card-body collapse" id="incomingTableCollapse">
            <div class="table-responsive">
              <table class="table datatable-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead class="datatable-header">
                  <tr>
                    <th class="sortable" data-mdb-sort="name">ID</th>
                    <th class="sortable" data-mdb-sort="name">Name</th>
                    <th class="sortable" data-mdb-sort="description">Description</th>
                    <th class="sortable" data-mdb-sort="sku">SKU</th>
                    <th class="sortable" data-mdb-sort="price">Price</th>
                    <th class="sortable" data-mdb-sort="quantity">Units</th>
                    <th class="sortable" data-mdb-sort="category">Category</th>
                    <th class="sortable" data-mdb-sort="subcategory">Subcategory</th>
                    <th class="sortable" data-mdb-sort="supplier">Supplier</th>
                  </tr>
                </thead>
                <tbody>
                  <% Product.all.each do |product| %>
                    <tr>
                      <td><%= form.check_box :product_ids, { multiple: true }, product.id, nil %></td>
                      <td><%= product.id %></td>
                      <td><%= product.name %></td>
                      <td><%= product.sku %></td>
                      <td>$<%= number_with_precision(product.price, precision: 2) %></td>
                      <td><%= product.stock_quantity %></td>
                      <td><%= product.category.try(:name) || '' %></td>
                      <td><%= product.subcategory.try(:name) || '' %></td>
                      <td><%= product.supplier.try(:name) || '' %></td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div>
        <%= form.submit %>
      </div>
    <% end %>

    <script>
      $(document).ready(function () {
        var table = $('#productTable').DataTable({
          paging: true,
          ordering: true,
          processing: true,
          serverSide: true,
          selectable: true,
          fixedheader: true
        });
      });
    </script>
