<!-- /workspaces/Inventory-Management-System/app/views/orders/incoming.html.erb -->

<h1>Incoming Orders</h1>

<div class="table-responsive">
  <table class="table datatable-bordered" id="incomingTable" width="100%" cellspacing="0">
    <thead class="datatable-header">
      <tr>
        <th class="sortable" data-mdb-sort="id">ID</th>
        <th class="sortable" data-mdb-sort="expected_delivery">Delivery EDA</th>
        <th class="sortable" data-mdb-sort="status">Status</th>
        <th class="sortable" data-mdb-sort="sending_address">Sending Address</th>
        <th class="sortable" data-mdb-sort="receiving_address">Receiving Address</th>
        <th class="sortable" data-mdb-sort="description">Tracking</th>
        <th class="sortable" data-mdb-sort="product_name">Product IDs</th>
        <th class="sortable" data-mdb-sort="quantity_ordered">Units</th>
        <th class="sortable" data-mdb-sort="shipping_cost">Shipping</th>
      </tr>
    </thead>
    <tbody>
      <% orders.incoming.each do |order| %>
        <tr data-href="<%= order_path(order) %>">
          <td><%= order.id %></td>
          <td><%= order.expected_delivery %></td>
          <td><%= order.status.gsub('_', ' ').titleize %></td>
          <td style="font-size: 12px;"><%= order.sending_address %></td>
          <td style="font-size: 12px;"><%= order.receiving_address %></td>
          <td><%= order.description %></td>
          <td><%= order.products.pluck(:id).join(', ') %></td>
          <td><%= order.order_products.sum(:quantity_ordered) %></td>
          <td>$<%= number_with_precision(order.order_products.sum(:shipping_cost), precision: 2) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var tableRows = document.querySelectorAll("#incomingTable tbody tr[data-href]");
    tableRows.forEach(function (row) {
      row.addEventListener("click", function () {
        window.location.href = this.dataset.href;
      });
    });
  });
</script>
